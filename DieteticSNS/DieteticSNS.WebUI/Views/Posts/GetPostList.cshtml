@using DieteticSNS.Application.Models.Comments.Commands.CreatePostComment;
@using DieteticSNS.Application.Models.Posts.Commands.UpdatePost;
@using DieteticSNS.Application.Models.Posts.Queries.GetPostList
@using DieteticSNS.Application.Models.Users.Queries.GetSuggestedUserList

@using DieteticSNS.Application.Common.Extensions
@using DieteticSNS.Application.Common.Interfaces
@inject ICurrentUserService currentUserService

@{
    Layout = "~/Views/Shared/_StandardLayout.cshtml";

    CreatePostCommentCommand createPostCommentCommand = new CreatePostCommentCommand();
    UpdatePostCommand updatePostCommand = new UpdatePostCommand();

    PostListVm posts = (PostListVm)ViewBag.PostList;
    SuggestedUserListVm suggestedUsers = (SuggestedUserListVm)ViewBag.SuggestedUserList;

    string dir = "~/img/uploads/";
    string noAvatar = "~/img/noavatar.jpg";
}

<partial name="~/Views/Posts/_CreatePost.cshtml" />

@foreach (var post in posts.Posts)
{
    <div class="card my-4" id="@("postCard_"+post.Id)">
        <!-- #region Post details -->
        <div class="card-body pb-0">
            <div class="row mb-2">
                <div class="col-auto">
                    @if (!String.IsNullOrEmpty(post.AvatarPath))
                    {
                        <img class="rounded-circle img-fluid border border-dark" style="height: 4rem; width: 4rem" src="@String.Concat(dir, post.AvatarPath)" asp-append-version="true" alt="Avatar">
                    }
                    else
                    {
                        <img class="rounded-circle img-fluid border border-dark" style="height: 4rem; width: 4rem" src="@noAvatar" asp-append-version="true" alt="Avatar">
                    }
                </div>
                <div class="col">
                    <div class="row">
                        <div class="col">
                            <h5 class="mb-3">
                                <a asp-controller="Users" asp-action="GetProfile" asp-route-id="@post.UserId" class="no-link">
                                    @post.FirstName @post.LastName
                                </a>
                            </h5>
                        </div>
                        <div class="col-auto">
                            <h6 class="text-muted">@post.CreatedAt.TimeAgo()</h6>
                        </div>
                        <div class="col-auto">
                            <!-- #region Post dropdown -->
                            <div class="dropdown d-inline">
                                <a href="#" data-toggle="dropdown" class="no-link">
                                    <i class="fas fa-ellipsis-h"></i>
                                </a>
                                @if (post.UserId == int.Parse(currentUserService.GetUserId()))
                                {
                                    <div class="dropdown-menu dropdown-menu-right">
                                        <form id="@("editForm_"+post.Id)" asp-controller="Posts" asp-action="UpdatePost" asp-route-id="@post.Id" autocomplete="off" method="post" data-ajax="true" data-ajax-method="post" data-ajax-complete="hideModal('#editModal_'+@post.Id)" data-ajax-success="setTimeout(updateCard, 300, @post.Id)">
                                            <button id="@("editButton_"+post.Id)" type="button" class="dropdown-item" data-toggle="modal" data-target="@("#editModal_"+post.Id)">Edit post <i class="far fa-edit"></i></button>
                                        </form>
                                        <div class="dropdown-divider"></div>
                                        <form id="@("deleteForm_"+post.Id)" asp-controller="Posts" asp-action="DeletePost" asp-route-id="@post.Id" method="post" data-ajax="true" data-ajax-method="post" data-ajax-complete="hideModal('#deleteModal_'+@post.Id)" data-ajax-success="setTimeout(deletePost, 400, '#postCard_'+@post.Id)">
                                            <button type="button" class="dropdown-item" data-toggle="modal" data-target="@("#deleteModal_"+post.Id)">Delete post <i class="far fa-trash-alt"></i></button>
                                        </form>
                                    </div>

                                    <div class="modal fade" id="@("deleteModal_"+post.Id)" tabindex="-1">
                                        <div class="modal-dialog modal-sm modal-dialog-centered">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title">Delete confirmation</h5>
                                                    <button type="button" class="close" style="outline: none" data-dismiss="modal"><span>&times;</span></button>
                                                </div>
                                                <div class="modal-body">
                                                    Are you sure to delete this post?
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                                    <button type="submit" class="btn btn-danger" form="@("deleteForm_"+post.Id)">Delete</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="modal fade" id="@("editModal_"+post.Id)" tabindex="-1">
                                        <div class="modal-dialog modal-lg modal-dialog-centered">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title">Post edit</h5>
                                                    <button type="button" class="close" style="outline: none" data-dismiss="modal"><span>&times;</span></button>
                                                </div>
                                                <div class="modal-body">
                                                    @{
                                                        updatePostCommand.Id = post.Id;
                                                        updatePostCommand.Title = post.Title;
                                                        updatePostCommand.Description = post.Description;
                                                    }
                                                    <input asp-for="@updatePostCommand.Id" form="@("editForm_"+post.Id)" hidden />
                                                    <div class="form-group row">
                                                        <div class="col-2 text-right">
                                                            <label asp-for="@updatePostCommand.Title" for="Title" class="col-form-label"><b>Title</b></label>
                                                        </div>
                                                        <div class="col-10">
                                                            <input id=@("titleInput_"+post.Id) asp-for="@updatePostCommand.Title" type="text" class="form-control" placeholder="Enter title" form="@("editForm_"+post.Id)" required oninvalid="this.setCustomValidity('Please fill out this field')" oninput="setCustomValidity('')" maxlength="100">
                                                        </div>
                                                    </div>
                                                    <div class="form-group row">
                                                        <div class="col-2 text-right">
                                                            <label asp-for="@updatePostCommand.Description" for="description" class="col-form-label"><b>Description</b></label>
                                                        </div>
                                                        <div class="col-10">
                                                            <textarea id=@("descriptionInput_"+post.Id) asp-for="@updatePostCommand.Description" class="form-control" rows="3" placeholder="Say something here" form="@("editForm_"+post.Id)"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                                    <button type="submit" class="btn btn-danger" form="@("editForm_"+post.Id)">Save</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                                else
                                {
                                    @if (post.PostReports.Exists(x => x.AccuserId == int.Parse(currentUserService.GetUserId())))
                                    {
                                        <div class="dropdown-menu dropdown-menu-right">
                                            <button type="button" class="dropdown-item" disabled>Report post <i class="fas fa-exclamation-circle"></i></button>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="dropdown-menu dropdown-menu-right">
                                            <form id="@("reportPostForm_"+post.Id)" asp-controller="Reports" asp-action="CreatePostReport" asp-route-id="@post.Id" method="post" data-ajax="true" data-ajax-method="post" data-ajax-complete="hideModal('#reportPostModal_'+@post.Id)" data-ajax-success="setTimeout(disableReportPostButton, 300, @post.Id)">
                                                <button id="@("reportPostButton_"+post.Id)" type="button" class="dropdown-item" data-toggle="modal" data-target="@("#reportPostModal_"+post.Id)">Report post <i class="fas fa-exclamation-circle"></i></button>
                                            </form>
                                        </div>

                                        <div class="modal fade" id="@("reportPostModal_"+post.Id)" tabindex="-1">
                                            <div class="modal-dialog modal-sm modal-dialog-centered">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title">Report confirmation</h5>
                                                        <button type="button" class="close" style="outline: none" data-dismiss="modal"><span>&times;</span></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        Are you sure to report this post?
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                                        <button type="submit" class="btn btn-danger" form="@("reportPostForm_"+post.Id)">Report</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                }
                            </div>
                            <!-- #endregion -->
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <h6 id="@("title_"+post.Id)" class="card-title">@post.Title</h6>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <p id="@("description_"+post.Id)" class="card-text">
                        @if (!String.IsNullOrEmpty(post.Description))
                        {
                            @post.Description
                        }
                    </p>
                </div>
            </div>
        </div>
        <!-- #endregion -->
        <div class="text-center">
            <img class="card-img-top p-4" src=@String.Concat(dir, post.PhotoPath) asp-append-version="true" alt="Post image">
        </div>
        <div class="card-body pt-0">
            <!-- #region Post footer -->
            <div class="row justify-content-between">
                <div class="col-auto">
                    @if (post.PostLikes.Exists(x => x.UserId == int.Parse(currentUserService.GetUserId())))
                    {
                        <form id="@("postLikedForm_"+post.Id)" asp-controller="Likes" asp-action="DeleteLike" asp-route-id="@post.PostLikes.FirstOrDefault(x => x.UserId == int.Parse(currentUserService.GetUserId()))?.Id" method="post" class="d-inline" data-ajax="true" data-ajax-method="post" data-ajax-success="setTimeout(postLikeToggle, 300, false, @post.Id, @currentUserService.GetUserId())">
                            <button id="@("postLikedButton_"+post.Id)" type="submit" class="btn btn-link text-decoration-none text-dark p-0"><h6><i class="far fa-thumbs-up text-primary"></i> Liked</h6></button>
                        </form>
                        <form asp-controller="Likes" asp-action="CreatePostLike" asp-route-id="@post.Id" method="post" class="d-inline" data-ajax="true" data-ajax-method="post" data-ajax-success="setTimeout(postLikeToggle, 300, true, @post.Id, @currentUserService.GetUserId())">
                            <button id="@("postLikeButton_"+post.Id)" type="submit" class="btn btn-link text-decoration-none text-dark p-0 d-none"><h6><i class="far fa-thumbs-up"></i> Like</h6></button>
                        </form>
                    }
                    else
                    {
                        <form id="@("postLikedForm_"+post.Id)" asp-controller="Likes" asp-action="DeleteLike" asp-route-id="@post.PostLikes.FirstOrDefault(x => x.UserId == int.Parse(currentUserService.GetUserId()))?.Id" method="post" class="d-inline" data-ajax="true" data-ajax-method="post" data-ajax-success="setTimeout(postLikeToggle, 300, false, @post.Id, @currentUserService.GetUserId())">
                            <button id="@("postLikedButton_"+post.Id)" type="submit" class="btn btn-link text-decoration-none text-dark p-0 d-none"><h6><i class="far fa-thumbs-up text-primary"></i> Liked</h6></button>
                        </form>
                        <form asp-controller="Likes" asp-action="CreatePostLike" asp-route-id="@post.Id" method="post" class="d-inline" data-ajax="true" data-ajax-method="post" data-ajax-success="setTimeout(postLikeToggle, 300, true, @post.Id, @currentUserService.GetUserId())">
                            <button id="@("postLikeButton_"+post.Id)" type="submit" class="btn btn-link text-decoration-none text-dark p-0"><h6><i class="far fa-thumbs-up"></i> Like</h6></button>
                        </form>
                    }

                    @if (post.PostLikes.Count > 0)
                    {
                        <button id="@("showPostLikesButton_"+post.Id)" class="btn btn-link text-decoration-none text-dark p-0" data-toggle="modal" data-target="@("#postLikeModal_"+post.Id)"><h6>(<span id="@("postLikeCounter_"+post.Id)">@post.PostLikes.Count</span>)</h6></button>
                    }
                    else
                    {
                        <button id="@("showPostLikesButton_"+post.Id)" class="btn btn-link text-decoration-none text-dark p-0" data-toggle="modal" data-target="@("#postLikeModal_"+post.Id)" disabled><h6>(<span id="@("postLikeCounter_"+post.Id)">@post.PostLikes.Count</span>)</h6></button>
                    }
                    <div class="modal fade" id="@("postLikeModal_"+post.Id)" tabindex="-1">
                        <div class="modal-dialog modal modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Post likes</h5>
                                    <button type="button" class="close" style="outline: none" data-dismiss="modal"><span>&times;</span></button>
                                </div>
                                <div class="list-group list-group-flush">
                                    @foreach (var like in post.PostLikes)
                                    {
                                        <a asp-controller="Users" asp-action="GetProfile" asp-route-id="@like.UserId" id="@("postLike_"+post.Id+"_"+like.UserId)" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center py-2">
                                            <h5 class="mt-2">@like.FirstName @like.LastName</h5>
                                            @if (!String.IsNullOrEmpty(like.AvatarPath))
                                            {
                                                <img class="rounded-circle img-fluid border border-dark" style="height: 2.5rem; width: 2.5rem" src="@String.Concat(dir, like.AvatarPath)" asp-append-version="true" alt="Avatar">
                                            }
                                            else
                                            {
                                                <img class="rounded-circle img-fluid border border-dark" style="height: 2.5rem; width: 2.5rem" src="@noAvatar" asp-append-version="true" alt="Avatar">
                                            }
                                        </a>
                                    }
                                    <a asp-controller="Users" asp-action="GetProfile" asp-route-id="@currentUserService.GetUserId()" id="@("tempPostLike_"+post.Id)" class="list-group-item list-group-item-action justify-content-between align-items-center py-2" hidden>
                                        <h5 class="mt-2">@currentUserService.GetUserFullName()</h5>
                                        @if (!String.IsNullOrEmpty(currentUserService.GetUserAvatarPath()))
                                        {
                                            <img class="rounded-circle img-fluid border border-dark" style="height: 2.5rem; width: 2.5rem" src="@currentUserService.GetUserAvatarPath()" asp-append-version="true" alt="Avatar">
                                        }
                                        else
                                        {
                                            <img class="rounded-circle img-fluid border border-dark" style="height: 2.5rem; width: 2.5rem" src="@noAvatar" asp-append-version="true" alt="Avatar">
                                        }
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-auto" onclick="toggleDiv('comments_'+@post.Id)">
                    <h6 class="clickable">
                        <i class="far fa-comments"></i> Comments (<span id="@("commentCounter_"+post.Id)">@post.PostComments.Count</span>)
                    </h6>
                </div>
            </div>
            <!-- #endregion -->
            <!-- #region Comments section -->
            <div id="@("comments_"+post.Id)" style="display: none">
                <hr class="mt-2" />
                @foreach (var comment in post.PostComments)
                {
                    <div class="pb-2" id="@("postComment_"+comment.Id)">
                        <div class="row flex-nowrap">
                            <div class="col-auto">
                                @if (!String.IsNullOrEmpty(comment.AvatarPath))
                                {
                                    <img class="rounded-circle img-fluid border border-dark" style="height: 2.5rem; width: 2.5rem" src="@String.Concat(dir, comment.AvatarPath)" asp-append-version="true" alt="Avatar">
                                }
                                else
                                {
                                    <img class="rounded-circle img-fluid border border-dark" style="height: 2.5rem; width: 2.5rem" src="@noAvatar" asp-append-version="true" alt="Avatar">
                                }
                            </div>
                            <div class="col-auto px-0 mb-0 flex-shrink-1">
                                <div class="jumbotron px-3 py-2 mb-0">
                                    <a asp-controller="Users" asp-action="GetProfile" asp-route-id="@comment.UserId" class="no-link">
                                        <b>@comment.FirstName @comment.LastName:</b>
                                    </a>
                                    <span class="text-break">@comment.Content</span>
                                </div>
                            </div>
                            <!-- #region Comment dropdown -->
                            <div class="col-auto my-auto pl-2">
                                <div class="dropdown d-inline">
                                    <a href="#" data-toggle="dropdown" class="no-link">
                                        <i class="fas fa-ellipsis-h"></i>
                                    </a>
                                    @if (comment.UserId == int.Parse(currentUserService.GetUserId()))
                                    {
                                        <div class="dropdown-menu dropdown-menu-right">
                                            <form id="@("deleteCommentForm_"+comment.Id)" asp-controller="Comments" asp-action="DeleteComment" asp-route-id="@comment.Id" method="post" data-ajax="true" data-ajax-method="post" data-ajax-complete="hideModal('#deleteCommentModal_'+@comment.Id)" data-ajax-success="setTimeout(deleteComment, 400, '#postComment_'+@comment.Id, '#commentCounter_'+@post.Id)">
                                                <button type="button" class="dropdown-item" data-toggle="modal" data-target="@("#deleteCommentModal_"+comment.Id)">Delete comment <i class="far fa-trash-alt"></i></button>
                                            </form>
                                        </div>

                                        <div class="modal fade" id="@("deleteCommentModal_"+comment.Id)" tabindex="-1">
                                            <div class="modal-dialog modal-sm modal-dialog-centered">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title">Delete confirmation</h5>
                                                        <button type="button" class="close" style="outline: none" data-dismiss="modal"><span>&times;</span></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        Are you sure to delete this comment?
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                                        <button type="submit" class="btn btn-danger" form="@("deleteCommentForm_"+comment.Id)">Delete</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                    else if (post.UserId == int.Parse(currentUserService.GetUserId()))
                                    {
                                        @if (comment.CommentReports.Exists(x => x.AccuserId == int.Parse(currentUserService.GetUserId())))
                                        {
                                            <div class="dropdown-menu dropdown-menu-right">
                                                <button type="button" class="dropdown-item" disabled>Report comment <i class="fas fa-exclamation-circle"></i></button>
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="dropdown-menu dropdown-menu-right">
                                                <form id="@("reportCommentForm_"+comment.Id)" asp-controller="Reports" asp-action="CreateCommentReport" asp-route-id="@comment.Id" method="post" data-ajax="true" data-ajax-method="post" data-ajax-complete="hideModal('#reportCommentModal_'+@comment.Id)" data-ajax-success="setTimeout(disableReportCommentButton, 300, @comment.Id)">
                                                    <button id="@("reportCommentButton_"+comment.Id)" type="button" class="dropdown-item" data-toggle="modal" data-target="@("#reportCommentModal_"+comment.Id)">Report comment <i class="fas fa-exclamation-circle"></i></button>
                                                </form>
                                                <div class="dropdown-divider"></div>
                                                <form id="@("deleteCommentForm_"+comment.Id)" asp-controller="Comments" asp-action="DeleteComment" asp-route-id="@comment.Id" method="post" data-ajax="true" data-ajax-method="post" data-ajax-complete="hideModal('#deleteCommentModal_'+@comment.Id)" data-ajax-success="setTimeout(deleteComment, 400, '#postComment_'+@comment.Id, '#commentCounter_'+@post.Id)">
                                                    <button type="button" class="dropdown-item" data-toggle="modal" data-target="@("#deleteCommentModal_"+comment.Id)">Delete comment <i class="far fa-trash-alt"></i></button>
                                                </form>
                                            </div>

                                            <div class="modal fade" id="@("reportCommentModal_"+comment.Id)" tabindex="-1">
                                                <div class="modal-dialog modal-sm modal-dialog-centered">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title">Report confirmation</h5>
                                                            <button type="button" class="close" style="outline: none" data-dismiss="modal"><span>&times;</span></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            Are you sure to report this comment?
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                                            <button type="submit" class="btn btn-danger" form="@("reportCommentForm_"+comment.Id)">Report</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="modal fade" id="@("deleteCommentModal_"+comment.Id)" tabindex="-1">
                                                <div class="modal-dialog modal-sm modal-dialog-centered">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title">Delete confirmation</h5>
                                                            <button type="button" class="close" style="outline: none" data-dismiss="modal"><span>&times;</span></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            Are you sure to delete this comment?
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                                            <button type="submit" class="btn btn-danger" form="@("deleteCommentForm_"+comment.Id)">Delete</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    }
                                    else
                                    {
                                        @if (comment.CommentReports.Exists(x => x.AccuserId == int.Parse(currentUserService.GetUserId())))
                                        {
                                            <div class="dropdown-menu dropdown-menu-right">
                                                <button type="button" class="dropdown-item" disabled>Report comment <i class="fas fa-exclamation-circle"></i></button>
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="dropdown-menu dropdown-menu-right">
                                                <form id="@("reportCommentForm_"+comment.Id)" asp-controller="Reports" asp-action="CreateCommentReport" asp-route-id="@comment.Id" method="post" data-ajax="true" data-ajax-method="post" data-ajax-complete="hideModal('#reportCommentModal_'+@comment.Id)" data-ajax-success="setTimeout(disableReportCommentButton, 300, @comment.Id)">
                                                    <button id="@("reportCommentButton_"+comment.Id)" type="button" class="dropdown-item" data-toggle="modal" data-target="@("#reportCommentModal_"+comment.Id)">Report comment <i class="fas fa-exclamation-circle"></i></button>
                                                </form>
                                            </div>

                                            <div class="modal fade" id="@("reportCommentModal_"+comment.Id)" tabindex="-1">
                                                <div class="modal-dialog modal-sm modal-dialog-centered">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title">Report confirmation</h5>
                                                            <button type="button" class="close" style="outline: none" data-dismiss="modal"><span>&times;</span></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            Are you sure to report this comment?
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                                            <button type="submit" class="btn btn-danger" form="@("reportCommentForm_"+comment.Id)">Report</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    }
                                </div>
                            </div>
                            <!-- #endregion -->
                        </div>
                        <div class="row">
                            <div class="col-auto">
                                <div style="width: 2.5rem"></div>
                            </div>
                            <div class="col-auto">
                                @if (comment.CommentLikes.Exists(x => x.UserId == int.Parse(currentUserService.GetUserId())))
                                {
                                    <form id="@("commentLikedForm_"+comment.Id)" asp-controller="Likes" asp-action="DeleteLike" asp-route-id="@comment.CommentLikes.FirstOrDefault(x => x.UserId == int.Parse(currentUserService.GetUserId()))?.Id" method="post" class="d-inline" data-ajax="true" data-ajax-method="post" data-ajax-success="setTimeout(commentLikeToggle, 300, false, @comment.Id, @currentUserService.GetUserId())">
                                        <button id="@("commentLikedButton_"+comment.Id)" type="submit" class="btn btn-link text-decoration-none text-dark p-0"><small><i class="far fa-thumbs-up text-primary"></i> Liked</small></button>
                                    </form>
                                    <form asp-controller="Likes" asp-action="CreateCommentLike" asp-route-id="@comment.Id" method="post" class="d-inline" data-ajax="true" data-ajax-method="post" data-ajax-success="setTimeout(commentLikeToggle, 300, true, @comment.Id, @currentUserService.GetUserId())">
                                        <button id="@("commentLikeButton_"+comment.Id)" type="submit" class="btn btn-link text-decoration-none text-dark p-0 d-none"><small><i class="far fa-thumbs-up"></i> Like</small></button>
                                    </form>
                                }
                                else
                                {
                                    <form id="@("commentLikedForm_"+comment.Id)" asp-controller="Likes" asp-action="DeleteLike" asp-route-id="@comment.CommentLikes.FirstOrDefault(x => x.UserId == int.Parse(currentUserService.GetUserId()))?.Id" method="post" class="d-inline" data-ajax="true" data-ajax-method="post" data-ajax-success="setTimeout(commentLikeToggle, 300, false, @comment.Id, @currentUserService.GetUserId())">
                                        <button id="@("commentLikedButton_"+comment.Id)" type="submit" class="btn btn-link text-decoration-none text-dark p-0 d-none"><small><i class="far fa-thumbs-up text-primary"></i> Liked</small></button>
                                    </form>
                                    <form asp-controller="Likes" asp-action="CreateCommentLike" asp-route-id="@comment.Id" method="post" class="d-inline" data-ajax="true" data-ajax-method="post" data-ajax-success="setTimeout(commentLikeToggle, 300, true, @comment.Id, @currentUserService.GetUserId())">
                                        <button id="@("commentLikeButton_"+comment.Id)" type="submit" class="btn btn-link text-decoration-none text-dark p-0"><small><i class="far fa-thumbs-up"></i> Like</small></button>
                                    </form>
                                }

                                @if (comment.CommentLikes.Count > 0)
                                {
                                    <button id="@("showCommentLikesButton_"+comment.Id)" class="btn btn-link text-decoration-none text-dark p-0" data-toggle="modal" data-target="@("#commentLikeModal_"+comment.Id)"><small>(<span id="@("commentLikeCounter_"+comment.Id)">@comment.CommentLikes.Count</span>)</small></button>
                                }
                                else
                                {
                                    <button id="@("showCommentLikesButton_"+comment.Id)" class="btn btn-link text-decoration-none text-dark p-0" data-toggle="modal" data-target="@("#commentLikeModal_"+comment.Id)" disabled><small>(<span id="@("commentLikeCounter_"+comment.Id)">@comment.CommentLikes.Count</span>)</small></button>
                                }
                                <div class="modal fade" id="@("commentLikeModal_"+comment.Id)" tabindex="-1">
                                    <div class="modal-dialog modal modal-dialog-centered">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title">Comment likes</h5>
                                                <button type="button" class="close" style="outline: none" data-dismiss="modal"><span>&times;</span></button>
                                            </div>
                                            <div class="list-group list-group-flush">
                                                @foreach (var like in comment.CommentLikes)
                                                {
                                                    <a asp-controller="Users" asp-action="GetProfile" asp-route-id="@like.UserId" id="@("commentLike_"+comment.Id+"_"+like.UserId)" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center py-2">
                                                        <h5 class="mt-2">@like.FirstName @like.LastName</h5>
                                                        @if (!String.IsNullOrEmpty(like.AvatarPath))
                                                        {
                                                            <img class="rounded-circle img-fluid border border-dark" style="height: 2.5rem; width: 2.5rem" src="@String.Concat(dir, like.AvatarPath)" asp-append-version="true" alt="Avatar">
                                                        }
                                                        else
                                                        {
                                                            <img class="rounded-circle img-fluid border border-dark" style="height: 2.5rem; width: 2.5rem" src="@noAvatar" asp-append-version="true" alt="Avatar">
                                                        }
                                                    </a>
                                                }
                                                <a asp-controller="Users" asp-action="GetProfile" asp-route-id="@currentUserService.GetUserId()" id="@("tempCommentLike_"+comment.Id)" class="list-group-item list-group-item-action justify-content-between align-items-center py-2" hidden>
                                                    <h5 class="mt-2">@currentUserService.GetUserFullName()</h5>
                                                    @if (!String.IsNullOrEmpty(currentUserService.GetUserAvatarPath()))
                                                    {
                                                        <img class="rounded-circle img-fluid border border-dark" style="height: 2.5rem; width: 2.5rem" src="@currentUserService.GetUserAvatarPath()" asp-append-version="true" alt="Avatar">
                                                    }
                                                    else
                                                    {
                                                        <img class="rounded-circle img-fluid border border-dark" style="height: 2.5rem; width: 2.5rem" src="@noAvatar" asp-append-version="true" alt="Avatar">
                                                    }
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-auto px-0" style="padding-top: 0.15rem">
                                <small>@comment.CreatedAt.TimeAgo()</small>
                            </div>
                        </div>
                    </div>
                }
                <div class="row">
                    <div class="col-auto">
                        <img id=@("avatarPath_"+post.Id) class="rounded-circle img-fluid border border-dark" style="height: 2.5rem; width: 2.5rem" src="@currentUserService.GetUserAvatarPath()" asp-append-version="true" alt="Avatar">
                    </div>
                    <div class="col pl-0">
                        @{
                            createPostCommentCommand.PostId = post.Id;
                        }
                        <form asp-controller="Comments"
                              asp-action="CreateComment"
                              autocomplete="off"
                              method="post"
                              data-ajax="true"
                              data-ajax-method="post"
                              data-ajax-complete="clearContentInput(@post.Id)">
                            <input asp-for="@createPostCommentCommand.PostId" hidden />
                            <input id=@("contentInput_"+post.Id) asp-for="@createPostCommentCommand.Content" type="text" class="form-control" placeholder="Write a comment...">
                            <input type="submit" hidden />
                        </form>
                    </div>
                </div>
            </div>
            <!-- #endregion -->
        </div>
    </div>
}

<span id="userId" hidden>@currentUserService.GetUserId()</span>

@section LeftPanel
{
    <partial name="Layout/_UserProfile" />
}

@section RightPanel
{
    @if (suggestedUsers.Users.Count != 0)
    {
        <div id="suggestionCard" class="card my-4">
            <h5 class="card-header text-center">Suggested accounts</h5>
            <div id="suggestionList" class="list-group list-group-flush">
                @foreach (var user in suggestedUsers.Users)
                {
                    <div id="@("suggestionListItem_"+user.Id)" class="list-group-item py-3 pl-3 pr-2">
                        <div class="d-flex w-100 justify-content-start">
                            @if (!String.IsNullOrEmpty(user.AvatarPath))
                            {
                                <img class="rounded-circle img-fluid border border-dark" style="height: 3.5rem; width: 3.5rem" src="@String.Concat(dir, user.AvatarPath)" asp-append-version="true" alt="Avatar">
                            }
                            else
                            {
                                <img class="rounded-circle img-fluid border border-dark" style="height: 3.5rem; width: 3.5rem" src="@noAvatar" asp-append-version="true" alt="Avatar">
                            }
                            <div class="ml-3">
                                <h6 class="mb-2">
                                    <a asp-controller="Users" asp-action="GetProfile" asp-route-id="@user.Id" class="no-link">
                                        @user.FirstName @user.LastName
                                    </a>
                                </h6>

                                <form asp-controller="Followings" asp-action="FollowUser" asp-route-userId="@user.Id" asp-route-followerId="@currentUserService.GetUserId()" method="post" data-ajax="true" data-ajax-method="post" data-ajax-success="setTimeout(deleteSuggestion, 300, @user.Id)">
                                    <button type="submit" class="btn btn-outline-dark btn btn-sm">Follow <i class="fas fa-user-plus"></i></button>
                                </form>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    }
}

@section Scripts
{
    <script src="~/js/changeFileLabelHtml.js"></script>
    <script src="~/js/theWall.js"></script>
}
